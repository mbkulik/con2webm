#!/usr/bin/env ksh

directory=$1
listed=`ls $directory`

if [ `uname` == "Darwin" ]; then
    vpx_flag="libvpx_vp8"
else
    vpx_flag="libvpx"
fi

for i in $listed; do
    if [[ "$i" = @(*.mp4|*.m4v) ]]; then

        mpegpath="${directory}/${i}"
        webmpath=${mpegpath%@(*.mp4|*.m4v)}.webm
        
        if [ ! -f $webmpath ]; then
            ffmpeg -i $mpegpath -f webm -vcodec $vpx_flag \
            -acodec libvorbis -ab 160000 -sameq $webmpath
        fi
    fi
done
